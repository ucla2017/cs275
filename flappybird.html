<!DOCTYPE html>
<html lang="en">
	<head>
		<title>cs275</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				background:#777;
				padding:0;
				margin:0;
				font-weight: bold;
				overflow:hidden;
			}

			#info {
				position: absolute;
				top: 0px; width: 100%;
				color: #ffffff;
				padding: 5px;
				font-family:Monospace;
				font-size:13px;
				text-align:center;
				z-index:1000;
			}

			a {
				color: #ffffff;
			}

			#footer { width: 100%; margin: 2em auto; text-align: center; position: absolute; bottom: 0 }
			strong { color: red }

			#oldie a { color:#da0 }
		</style>
	</head>

	<body>
		<!-- <div id="info"><a href="http://threejs.org" target="_blank">three.js</a> - webgl cube refraction demo. skybox by <a href="http://www.zfight.com/" target="_blank">Jochum Skoglund</a></div> -->

		<div id="footer">
			press <strong>f</strong> to flap wings
		</div>

		<div id="status"> status started...</div>

		<div id="log"> log started...</div>


		<script src="three.js/three.min.js"></script>

		<script src="js/Detector.js"></script>

		<script src="graphics.js"></script>

		<script src="controller.js"></script>
		
		<script src="learning.js"></script>

		<script>

			if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
			var container;
			var clock = new THREE.Clock();
			var STATUS = {};
			STATUS.MENU = 0, STATUS.GAME = 1, STATUS.DEBUG = 2, STATUS.LEARNING = 3, STATUS.SHOWTIME = 4;
			var state = STATUS.MENU;	//state of the game(0: menu, 1: game, 2: debug, 3: learning, 4: showtime)			
			var mouseX = 0, mouseY = 0;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

			document.addEventListener('mousemove', onDocumentMouseMove, false );

			init();
			animate();

			function init() {

				container = document.createElement( 'div' );
				document.body.appendChild( container );
				
				Controller.init();
				Graphics.init( container, bird, pillars);

				window.addEventListener( 'resize', Graphics.onWindowResize, false );
				document.addEventListener( 'keydown', onKeyDown, false );
			}

			function onDocumentMouseMove(event) {
				mouseX = ( event.clientX - windowHalfX ) * 10;
				mouseY = ( event.clientY - windowHalfY ) * 10;
			}

			function animate() {				

				requestAnimationFrame( animate );

				var delta = clock.getDelta();
				var elapseTime = clock.getElapsedTime();

				switch (state) {
					case STATUS.MENU ://menu
						Graphics.menu();
						Graphics.update(mouseX, mouseY, delta, elapseTime, pillars, bird);
						break;
					case STATUS.GAME ://game
					case STATUS.DEBUG ://debug
						Controller.perception();		//check visible						
						if (Learning.jump()) {			//has jumped?
							bird.v = k_Vjump;//update bird's speed
							Graphics.flapWings();
							Graphics.setLog('just jumped');
						}						
						Controller.move(delta);			//update positions
						if (Controller.collision()) //the bird died
							state = 0;//back to menu
						else
							//Graphics.update(state, mouseX, mouseY, delta, elapseTime, pillars, bird);
							Graphics.update(mouseX, mouseY, delta, elapseTime, pillars, bird);
						break;
					case STATUS.LEARNING ://learning
						break;
					case STATUS.SHOWTIME ://showtime
						break;
					default:
						break;				
				}							
			}

			function onKeyDown ( event ) {

				switch (event.keyCode ) {
					case 32: //space
					case 70: //f: fly
						bird.v = k_Vjump;
						Graphics.flapWings();
						Graphics.setLog('<strong>f</strong> key pressed');
						break;
					case 27://escape
						state = 0;//back to menu
						break;
					case 49://1:game
					case 50://2:debug				
					case 51://3:learning
					case 52://4:showtime
						Controller.init();
						state = event.keyCode - 48;
						break;
					case 68: //d
						//dirLight.visible = !dirLight.visible;
					break;
				}
			}

		</script>

	</body>
</html>
